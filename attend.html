<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Class Attendance - PSYCH 403A1</title>
    <meta name="description" content="Class attendance tracking for PSYCH 403A1 Neuroimaging and Neurostimulation">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Spectral:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
      :root {
        --bg: #f8f4f8;
        --bg-2: #ede8ed;
        --text: #2d1b2d;
        --muted: #6b5a6b;
        --accent: #d63384;
        --accent-2: #20c997;
        --glow: rgba(214, 51, 132, 0.3);
        --neural: rgba(32, 201, 151, 0.2);
        --maxw: 880px;
      }

      html, body { height: 100%; }
      body {
        margin: 0;
        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--text);
        background: linear-gradient(135deg, #f8f4f8 0%, #ede8ed 25%, #f0ebf2 50%, #ebf2f0 75%, #f4f8f8 100%);
        line-height: 1.65;
        letter-spacing: 0.1px;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      .neural-grid {
        position: fixed;
        inset: 0;
        pointer-events: none;
        background-image:
          radial-gradient(2px 2px at 15% 25%, var(--neural) 0, transparent 50%),
          radial-gradient(1px 1px at 75% 35%, rgba(214,51,132,0.2) 0, transparent 50%),
          radial-gradient(1px 1px at 45% 65%, var(--neural) 0, transparent 50%),
          radial-gradient(2px 2px at 85% 85%, rgba(214,51,132,0.15) 0, transparent 50%),
          radial-gradient(1px 1px at 25% 75%, var(--neural) 0, transparent 50%);
        opacity: 0.4;
        animation: pulse-grid 8s ease-in-out infinite;
      }
      @keyframes pulse-grid { 
        0%, 100% { opacity: 0.4; transform: scale(1); } 
        50% { opacity: 0.6; transform: scale(1.02); } 
      }

      .container {
        max-width: var(--maxw);
        margin: 0 auto;
        padding: 48px 20px 80px;
      }

      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        margin-bottom: 28px;
      }

      .brand {
        font-weight: 700;
        letter-spacing: 0.6px;
        color: var(--muted);
        text-transform: uppercase;
        font-size: 12px;
      }

      h1, h2, h3 {
        font-family: Spectral, Georgia, "Times New Roman", serif;
        line-height: 1.2;
        margin: 0.2em 0 0.45em;
      }
      h1 {
        font-size: clamp(28px, 5vw, 46px);
        font-weight: 700;
        letter-spacing: 0.3px;
        text-shadow: 0 0 12px var(--glow);
      }
      h2 {
        font-size: clamp(22px, 3.5vw, 30px);
        color: #4a2d4a;
        margin-top: 2.2em;
      }

      p { margin: 0.85em 0; }

      .beat {
        height: 2px;
        background: linear-gradient(90deg, transparent, var(--accent), var(--accent-2), var(--accent), transparent);
        box-shadow: 0 0 20px var(--glow);
        margin: 26px 0;
        position: relative;
        border-radius: 2px;
      }

      .attendance-grid {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 14px;
        margin: 24px 0;
      }

      @media (max-width: 1024px) {
        .attendance-grid {
          grid-template-columns: 1fr 1fr;
        }
      }

      @media (max-width: 768px) {
        .attendance-grid {
          grid-template-columns: 1fr;
        }
      }

      .student-card {
        padding: 16px;
        background: rgba(255, 255, 255, 0.6);
        border: 1px solid rgba(214, 51, 132, 0.2);
        border-radius: 12px;
        transition: all 0.2s ease;
      }

      .student-card:hover {
        background: rgba(255, 255, 255, 0.8);
        border-color: rgba(214, 51, 132, 0.4);
        box-shadow: 0 2px 8px rgba(214, 51, 132, 0.1);
      }

      .student-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;
      }

      .student-name {
        font-weight: 600;
        color: var(--text);
        font-size: 15px;
      }

      .student-notes {
        width: 100%;
        min-height: 60px;
        padding: 8px 10px;
        border: 1px solid rgba(214, 51, 132, 0.3);
        border-radius: 6px;
        font-family: inherit;
        font-size: 13px;
        line-height: 1.4;
        background: rgba(255, 255, 255, 0.9);
        resize: vertical;
        box-sizing: border-box;
        transition: all 0.2s ease;
      }

      .student-notes:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 2px rgba(214, 51, 132, 0.1);
        min-height: 80px;
      }

      .student-notes::placeholder {
        color: var(--muted);
        font-style: italic;
      }

      /* Toggle Switch Styles */
      .toggle-switch {
        position: relative;
        width: 60px;
        height: 30px;
      }

      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.3s;
        border-radius: 30px;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 22px;
        width: 22px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.3s;
        border-radius: 50%;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      }

      input:checked + .slider {
        background-color: var(--accent-2);
      }

      input:checked + .slider:before {
        transform: translateX(30px);
      }

      .slider:after {
        content: 'Absent';
        position: absolute;
        left: 8px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 10px;
        color: white;
        font-weight: 600;
        opacity: 1;
        transition: opacity 0.3s;
      }

      input:checked + .slider:after {
        content: 'Present';
        left: -2px;
        opacity: 1;
      }

      .expertise-section {
        margin: 32px 0;
        padding: 20px;
        background: linear-gradient(135deg, rgba(32,201,151,0.12), rgba(214,51,132,0.08));
        border: 1px solid rgba(32,201,151,0.4);
        border-radius: 12px;
        box-shadow: 0 4px 16px rgba(32,201,151,0.1);
      }

      .expertise-section h3 {
        margin-top: 0;
        color: var(--accent);
      }

      .expertise-textarea {
        width: 100%;
        min-height: 120px;
        padding: 12px;
        border: 2px solid rgba(214, 51, 132, 0.3);
        border-radius: 8px;
        font-family: inherit;
        font-size: 14px;
        line-height: 1.5;
        background: rgba(255, 255, 255, 0.8);
        resize: vertical;
        box-sizing: border-box;
      }

      .expertise-textarea:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(214, 51, 132, 0.1);
      }

      .email-section {
        margin: 32px 0;
        text-align: center;
      }

      .email-button {
        background: linear-gradient(135deg, var(--accent), var(--accent-2));
        color: white;
        border: none;
        padding: 14px 28px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 16px rgba(214, 51, 132, 0.3);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .email-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(214, 51, 132, 0.4);
      }

      .email-button:active {
        transform: translateY(0);
      }

      .stats {
        display: flex;
        justify-content: space-around;
        margin: 24px 0;
        padding: 16px;
        background: rgba(255, 255, 255, 0.4);
        border-radius: 8px;
        border: 1px solid rgba(214, 51, 132, 0.2);
      }

      .stat-item {
        text-align: center;
      }

      .stat-number {
        font-size: 24px;
        font-weight: 700;
        color: var(--accent);
        display: block;
      }

      .stat-label {
        font-size: 12px;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .date-time {
        text-align: center;
        color: var(--muted);
        font-size: 14px;
        margin-bottom: 16px;
      }

      .actions {
        display: flex;
        gap: 12px;
        justify-content: center;
        margin: 16px 0;
        flex-wrap: wrap;
      }

      .action-btn {
        padding: 8px 16px;
        border: 1px solid rgba(214, 51, 132, 0.4);
        background: rgba(255, 255, 255, 0.6);
        color: var(--accent);
        border-radius: 6px;
        cursor: pointer;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.3px;
        transition: all 0.2s ease;
      }

      .action-btn:hover {
        background: rgba(214, 51, 132, 0.1);
        border-color: var(--accent);
      }

      footer {
        margin-top: 48px;
        padding-top: 18px;
        border-top: 1px solid rgba(122,225,255,0.25);
        color: var(--muted);
        font-size: 14px;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="neural-grid" aria-hidden="true"></div>
    <div class="container">
      <header>
        <div class="brand">PSYCH 403A1 — Class Attendance</div>
        <div class="date-time" id="currentDateTime"></div>
      </header>

      <main>
        <h1>Class Attendance Tracker</h1>
        <p>Track student attendance for PSYCH 403A1: Neuroimaging and Neurostimulation</p>
        
        <div class="beat" aria-hidden="true"></div>

        <div class="stats">
          <div class="stat-item">
            <span class="stat-number" id="presentCount">0</span>
            <span class="stat-label">Present</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="absentCount">39</span>
            <span class="stat-label">Absent</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="totalCount">39</span>
            <span class="stat-label">Total</span>
          </div>
        </div>

        <div class="actions">
          <button class="action-btn" onclick="markAllPresent()">Mark All Present</button>
          <button class="action-btn" onclick="markAllAbsent()">Mark All Absent</button>
          <button class="action-btn" onclick="clearAll()">Clear All</button>
        </div>

        <h2>Student Attendance</h2>
        <div class="attendance-grid" id="attendanceGrid">
          <!-- Students will be populated by JavaScript -->
        </div>

        <div class="expertise-section">
          <h3>General Class Notes</h3>
          <p>Record general observations, announcements, or overall class information:</p>
          <textarea 
            class="expertise-textarea" 
            id="generalNotes" 
            placeholder="Enter general class notes, announcements, overall observations, or other information about today's session..."></textarea>
        </div>

        <div class="email-section">
          <button class="email-button" id="emailButton" onclick="emailResults()">📧 Send Attendance Report</button>
          <p style="font-size: 12px; color: var(--muted); margin-top: 8px;">
            Report will be sent automatically to: kylemath@gmail.com
          </p>
          <div id="emailStatus" style="margin-top: 12px; padding: 8px; border-radius: 6px; display: none; font-size: 14px; text-align: center;"></div>
        </div>
      </main>

      <footer>
        <div>© <span id="year"></span> Kyle Mathewson - PSYCH 403A1 Attendance Tracker</div>
      </footer>
    </div>

    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    
    <script>
      // Initialize EmailJS with your public key
      // You'll need to replace 'YOUR_PUBLIC_KEY' with your actual EmailJS public key
      emailjs.init('Ma603AZn3tlRqjqAY');
      
      // Student data - parsed from names.md
      const students = [
        { id: 'rifai_abdul', name: 'Abdul Majid El Rifai' },
        { id: 'mahboubi_negareh', name: 'Negareh Mahboubi' },
        { id: 'anderson_tori', name: 'Tori Anderson' },
        { id: 'archibald_caitlyn', name: 'Caitlyn Archibald' },
        { id: 'arora_kirti', name: 'Kirti Arora' },
        { id: 'atkin_kaitlyn', name: 'Kaitlyn Atkin' },
        { id: 'badran_sarah', name: 'Sarah Badran' },
        { id: 'budzyk_kora', name: 'Kora Budzyk' },
        { id: 'chemello_natasha', name: 'Natasha Chemello' },
        { id: 'chooi_joshua', name: 'Joshua Chooi' },
        { id: 'cordez_kyle', name: 'Kyle Cordez' },
        { id: 'dhaliwal_simran', name: 'Simran Dhaliwal' },
        { id: 'dwivedi_roshni', name: 'Roshni Dwivedi' },
        { id: 'espino_ivan', name: 'Ivan Espino Lopez' },
        { id: 'farrell_dustin', name: 'Dustin Farrell' },
        { id: 'gannon_jake', name: 'Jake Gannon' },
        { id: 'jaber_samir', name: 'Samir Jaber' },
        { id: 'jimale_ayaan', name: 'Ayaan Jimale' },
        { id: 'jomha_mohamed', name: 'Mohamed Jomha' },
        { id: 'kelly_danielle', name: 'Danielle Kelly' },
        { id: 'khan_amna', name: 'Amna Khan' },
        { id: 'luo_yan', name: 'Yan Luo' },
        { id: 'maharaj_gia', name: 'Gia Maharaj' },
        { id: 'nwaka_angel', name: 'Angel Nwaka' },
        { id: 'osorio_alicia', name: 'Alicia Osorio' },
        { id: 'park_ryan', name: 'Ryan Park' },
        { id: 'patel_om', name: 'Om Patel' },
        { id: 'philips_eden', name: 'Eden Philips' },
        { id: 'radiansyah_rana', name: 'Rana Radiansyah' },
        { id: 'ruda_kiara', name: 'Kiara Ruda' },
        { id: 'saigh_marinaya', name: 'Marinaya Saigh' },
        { id: 'samiuddin_zainab', name: 'Zainab Samiuddin' },
        { id: 'sangha_gurleen', name: 'Gurleen Sangha' },
        { id: 'sekhon_bani', name: 'Bani Sekhon' },
        { id: 'sorochan_chloe', name: 'Chloe Sorochan' },
        { id: 'turna_jasleen', name: 'Jasleen Turna' },
        { id: 'wainwright_portia', name: 'Portia Wainwright' }
      ];

      // Initialize the page
      function initializePage() {
        updateDateTime();
        renderStudentList();
        updateStats();
        
        // Update date/time every minute
        setInterval(updateDateTime, 60000);
        
        // Set current year
        document.getElementById('year').textContent = new Date().getFullYear();
      }

      function updateDateTime() {
        const now = new Date();
        const options = {
          weekday: 'long',
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        };
        document.getElementById('currentDateTime').textContent = now.toLocaleDateString('en-US', options);
      }

      function renderStudentList() {
        const grid = document.getElementById('attendanceGrid');
        grid.innerHTML = students.map(student => `
          <div class="student-card">
            <div class="student-header">
              <span class="student-name">${student.name}</span>
              <label class="toggle-switch">
                <input type="checkbox" id="${student.id}" onchange="updateStats()">
                <span class="slider"></span>
              </label>
            </div>
            <textarea 
              class="student-notes" 
              id="notes_${student.id}" 
              placeholder="Expertise, interests, questions, participation notes..."></textarea>
          </div>
        `).join('');
      }

      function updateStats() {
        const checkboxes = document.querySelectorAll('.attendance-grid input[type="checkbox"]');
        const presentCount = Array.from(checkboxes).filter(cb => cb.checked).length;
        const totalCount = checkboxes.length;
        const absentCount = totalCount - presentCount;

        document.getElementById('presentCount').textContent = presentCount;
        document.getElementById('absentCount').textContent = absentCount;
        document.getElementById('totalCount').textContent = totalCount;
      }

      function markAllPresent() {
        const checkboxes = document.querySelectorAll('.attendance-grid input[type="checkbox"]');
        checkboxes.forEach(cb => cb.checked = true);
        updateStats();
      }

      function markAllAbsent() {
        const checkboxes = document.querySelectorAll('.attendance-grid input[type="checkbox"]');
        checkboxes.forEach(cb => cb.checked = false);
        updateStats();
      }

      function clearAll() {
        markAllAbsent();
        document.getElementById('generalNotes').value = '';
        
        // Clear all individual student notes
        students.forEach(student => {
          const notesField = document.getElementById(`notes_${student.id}`);
          if (notesField) notesField.value = '';
        });
      }

      async function emailResults() {
        const button = document.getElementById('emailButton');
        const status = document.getElementById('emailStatus');
        
        // Show loading state
        button.disabled = true;
        button.innerHTML = '⏳ Sending...';
        status.style.display = 'block';
        status.style.background = 'rgba(32, 201, 151, 0.1)';
        status.style.color = 'var(--accent-2)';
        status.style.border = '1px solid rgba(32, 201, 151, 0.3)';
        status.textContent = 'Preparing email...';

        try {
          const now = new Date();
          const dateStr = now.toLocaleDateString('en-US', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
          });
          const timeStr = now.toLocaleTimeString('en-US', {
            hour: '2-digit',
            minute: '2-digit'
          });

          // Collect attendance data
          const attendanceData = students.map(student => {
            const checkbox = document.getElementById(student.id);
            const notesField = document.getElementById(`notes_${student.id}`);
            return {
              name: student.name,
              present: checkbox.checked,
              notes: notesField ? notesField.value.trim() : ''
            };
          });

          const presentStudents = attendanceData.filter(s => s.present);
          const absentStudents = attendanceData.filter(s => !s.present);
          const generalNotes = document.getElementById('generalNotes').value.trim();
          
          // Collect students with individual notes
          const studentsWithNotes = attendanceData.filter(s => s.notes);

          // Create email content
          const subject = `PSYCH 403A1 Attendance Report - ${dateStr}`;
          const message = `PSYCH 403A1: Neuroimaging and Neurostimulation
Class Attendance Report

Date: ${dateStr}
Time: ${timeStr}
Location: T B-05 - Henry Marshall Tory Building

ATTENDANCE SUMMARY:
• Present: ${presentStudents.length} students
• Absent: ${absentStudents.length} students
• Total: ${students.length} students

PRESENT STUDENTS (${presentStudents.length}):
${presentStudents.map(s => `• ${s.name}`).join('\n')}

${absentStudents.length > 0 ? `ABSENT STUDENTS (${absentStudents.length}):\n${absentStudents.map(s => `• ${s.name}`).join('\n')}\n\n` : ''}${studentsWithNotes.length > 0 ? `INDIVIDUAL STUDENT NOTES:\n${studentsWithNotes.map(s => `• ${s.name}: ${s.notes}`).join('\n')}\n\n` : ''}${generalNotes ? `GENERAL CLASS NOTES:\n${generalNotes}\n\n` : ''}---
Generated by PSYCH 403A1 Attendance Tracker
© ${new Date().getFullYear()} Kyle Mathewson`;

          status.textContent = 'Sending email...';

          // Send email using EmailJS
          // Replace 'YOUR_SERVICE_ID' and 'YOUR_TEMPLATE_ID' with your actual EmailJS service and template IDs
          const response = await emailjs.send('service_gja051f', 'template_oynhafb', {
            to_email: 'kylemath@gmail.com',
            subject: subject,
            message: message,
            from_name: 'PSYCH 403A1 Attendance System',
            reply_to: 'noreply@ualberta.ca'
          });

          // Success
          button.innerHTML = '✅ Email Sent!';
          status.style.background = 'rgba(32, 201, 151, 0.15)';
          status.style.color = 'var(--accent-2)';
          status.style.border = '1px solid rgba(32, 201, 151, 0.4)';
          status.textContent = `✅ Attendance report sent successfully to kylemath@gmail.com`;
          
          // Reset button after 3 seconds
          setTimeout(() => {
            button.disabled = false;
            button.innerHTML = '📧 Send Attendance Report';
            status.style.display = 'none';
          }, 3000);

        } catch (error) {
          console.error('Email sending failed:', error);
          
          // Error state
          button.innerHTML = '❌ Send Failed';
          status.style.background = 'rgba(214, 51, 132, 0.1)';
          status.style.color = 'var(--accent)';
          status.style.border = '1px solid rgba(214, 51, 132, 0.4)';
          status.textContent = `❌ Failed to send email. Error: ${error.text || error.message || 'Unknown error'}`;
          
          // Fallback to mailto link
          setTimeout(() => {
            const subject = `PSYCH 403A1 Attendance Report - ${new Date().toLocaleDateString()}`;
            const body = `Email sending failed. Please copy the attendance data from the page and send manually.`;
            const mailtoLink = `mailto:kylemath@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.location.href = mailtoLink;
          }, 2000);
          
          // Reset button after 5 seconds
          setTimeout(() => {
            button.disabled = false;
            button.innerHTML = '📧 Send Attendance Report';
            status.style.display = 'none';
          }, 5000);
        }
      }

      // Initialize page when loaded
      document.addEventListener('DOMContentLoaded', initializePage);
    </script>
  </body>
</html>
